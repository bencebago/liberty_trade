---
title: "Democracy tradeoffs LISS"
output: html_notebook
---

Load libraries 

```{r}
# Read in libraries
library(haven)
library(tidyverse)
library(lmerTest)

options(tidyverse.quiet = TRUE)
options(dplyr.summarise.inform = FALSE)

```

Read in data

```{r setup}
# Load data
#LISS_democracy <- read_sav("C:/Users/damasino/OneDrive - Tilburg University/Desktop/Research/Tilburg/Democracy tradeoffs/LISS September 2025/L_TiUMon_SID_1.0p.sav")

LISS_democracy <- read_sav("C:/Users/bbago/OneDrive - Tilburg University/Documents/GitHub/liberty/L_TiUMon_SID_1.0p.sav")

LISS_democracy <- LISS_democracy %>%
  mutate(nettocat = case_when(
    nettocat %in% c(13, 14) ~ NA_real_,  # Use NA_real_ for numeric, NA_character_ for character
    TRUE ~ nettocat  # Keep all other values as is
  ))


# Get rid of incomplete answers: N = 45, total resulting N  = 2251
LISS_democracy_complete = LISS_democracy %>% drop_na(Q7d) # drop any with incomplete answers to problems

# Switch data to long format for each round
LISS_democracy_long = LISS_democracy_complete %>%
  mutate(across(matches("^(problem|problem__|cost_|benefit_|affected_)\\d+$"), zap_labels)) %>%  # remove labels
  pivot_longer(
    cols = matches("^(problem|problem__|cost_|benefit_|affected_)\\d+$"), 
    names_to = c(".value", "round"), 
    names_pattern = "^(problem|problem__|cost_|benefit_|affected_)(\\d+)"
    )  %>%
  mutate(round = as.integer(round)) %>% # make round as an integer
  rename(problem_order = "problem__", benefit = "benefit_", cost = "cost_", affected = "affected_", problem_resp = "problem") %>% # name columns more nicely
  relocate(c("round", "problem_resp", "benefit", "cost", "affected", "problem_order"), .after = "voorbeeld") # Rearrange columns

# Label the type of liberty and benefit for each, add in the numerical values for costs/benefits

LISS_democracy_long = LISS_democracy_long %>%
  mutate(liberty_type = case_when(round %in% c(1,2,3) ~ "speech", 
                                  round %in% c(4,5,6) ~"press", 
                                  round %in% c(7,8,9) ~"due_process", 
                                  round %in% c(10,11,12) ~"assembly", 
                                  round %in% c(13,14,15) ~"equality", 
                                  round %in% c(16,17,18) ~"privacy" ), 
         benefit_type = case_when(round %in% c(1,5,8,11,14,17) ~"money", 
                                  round %in% c(2,6,9,12,15,18) ~"security",
                                  round %in% c(3,4,7,10,13,16) ~"convenience"),
         benefit_value = case_when(round %in% c(1,5,8,11,14,17) & benefit == 1 ~ 50,
                                   round %in% c(1,5,8,11,14,17) & benefit == 2 ~ 100,
                                   round %in% c(1,5,8,11,14,17) & benefit == 3 ~ 200, 
                                   round %in% c(2,3,4,6,7,9,10,12,13,15,16,18) & benefit == 1 ~ 50,
                                   round %in% c(2,3,4,6,7,9,10,12,13,15,16,18) & benefit == 2 ~ 70,
                                   round %in% c(2,3,4,6,7,9,10,12,13,15,16,18) & benefit == 3 ~ 90), 
         benefit_stat = case_when(benefit == 1 ~ -1,
                                  benefit == 2 ~ 0,
                                  benefit == 3 ~ 1),
         cost_stat = case_when(cost == 1 ~ -1,
                               cost == 2 ~ 0,
                               cost == 3 ~ 1),
         cost_value = case_when(cost == 1 ~ 10,
                                cost == 2 ~ 30,
                                cost == 3 ~ 50), 
         affected_group = case_when(affected == 1 ~ "Left", 
                                    affected == 2 ~ "Right", 
                                    affected == 3 ~ "Everyone"),
         affected_stat = case_when(affected == 1 & Q6 < 50 ~ 1 ,
                              affected == 1 & Q6 > 49 ~ -1,
                              affected == 2 & Q6 < 50 ~ -1 ,
                              affected == 2 & Q6 > 49 ~ 1,
                              affected == 3 ~ 0),
         outparty_dislike = case_when(Q6 < 50 ~ Q5a,
                                      Q6 > 49 ~ Q5b),
         liberty_prior_societal = case_when(liberty_type == 'speech' ~ Q2c,
                                   liberty_type == 'press' ~ Q2b,
                                   liberty_type == 'due_process' ~ Q2d,
                                   liberty_type == 'assembly' ~ Q2a,
                                   liberty_type == 'equality' ~ Q2e,
                                   liberty_type == 'privacy' ~ Q2f),
         liberty_prior_personal = case_when(liberty_type == 'speech' ~ Q1c,
                                   liberty_type == 'press' ~ Q1b,
                                   liberty_type == 'due_process' ~ Q1d,
                                   liberty_type == 'assembly' ~ Q1a,
                                   liberty_type == 'equality' ~ Q1e,
                                   liberty_type == 'privacy' ~ Q1f)) %>%
  relocate(c("liberty_type", "benefit_type", "benefit_value", "cost_value", "affected_group"), .after = "affected") # Rearrange columns

# Q1 = personal importance 
# Q2 = societal/democratic importance
# a = assembly/demonstrations
# b = press/variety of media
# c = speech/diverse opinions social media
# d = due process/present court cases
# e = equality/equal treatment in job applications
# f = privacy/private from gov't

# Q3 = political party supported
# Q4 = strength of belief/support

# Q5 = feelings toward two groups
# a = left leaning
# b = right leaning

# Q6 = self placement on 0 =left to 100 = right scale

# Q7 How acceptable is it for own-party or leaning politicians to:
# a = prosecute journalists
# b = not accept election results if loss
# c = reduce support for opposite side media
# d = revoke charitable(?) status of organizations affiliated with opposite side

  
```


Descriptives

```{r descriptives}
# Age
hist(LISS_democracy$leeftijd)

# Political leaning left - right
hist(LISS_democracy$Q6)



hist(LISS_democracy_long$liberty_prior_personal)



liberty_data <- LISS_democracy %>%
  select(Q1a, Q1b, Q1c, Q1d, Q1e, Q1f) %>%
  pivot_longer(
    cols = everything(),
    names_to = "question",
    values_to = "value"
  ) %>%
  mutate(
    liberty_type = case_when(
      question == "Q1c" ~ "speech",
      question == "Q1b" ~ "press",
      question == "Q1d" ~ "due_process",
      question == "Q1a" ~ "assembly",
      question == "Q1e" ~ "equality",
      question == "Q1f" ~ "privacy"
    )
  )
liberty_data <- liberty_data %>%
  group_by(liberty_type) %>%
  mutate(median_val = median(value, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(liberty_type = fct_reorder(liberty_type, median_val))

# Create horizontal boxplot
ggplot(liberty_data, aes(x = value, y = liberty_type)) +
  geom_boxplot(fill = "steelblue", alpha = 0.7) +
  labs(
    title = "Distribution of Values by Liberty Type",
    x = "Value",
    y = "Liberty Type"
  ) +
  theme_minimal()

cor.test(LISS_democracy$Q2a, LISS_democracy$Q1a)#assembly

cor.test(LISS_democracy$Q1f, LISS_democracy$Q2f)#privacy

liberty_data <- LISS_democracy %>%
  select(Q2a, Q2b, Q2c, Q2d, Q2e, Q2f) %>%
  pivot_longer(
    cols = everything(),
    names_to = "question",
    values_to = "value"
  ) %>%
  mutate(
    liberty_type = case_when(
      question == "Q2c" ~ "speech",
      question == "Q2b" ~ "press",
      question == "Q2d" ~ "due_process",
      question == "Q2a" ~ "assembly",
      question == "Q2e" ~ "equality",
      question == "Q2f" ~ "privacy"
    )
  )
liberty_data <- liberty_data %>%
  group_by(liberty_type) %>%
  mutate(median_val = median(value, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(liberty_type = fct_reorder(liberty_type, median_val))

# Create horizontal boxplot
ggplot(liberty_data, aes(x = value, y = liberty_type)) +
  geom_boxplot(fill = "steelblue", alpha = 0.7) +
  labs(
    title = "Distribution of Values by Liberty Type",
    x = "Value",
    y = "Liberty Type"
  ) +
  theme_minimal()



```


Inter-liberty and inter-benefit effects

```{r visualisation}

library(ggplot2)
library(dplyr)

# Option 1: Simple bar graph with means and error bars
LISS_democracy_long %>%
  group_by(liberty_type) %>%
  summarise(
    mean_concern = mean(problem_resp, na.rm = TRUE),
    sd_concern = sd(problem_resp, na.rm = TRUE),
    se_concern = sd_concern / sqrt(n()),
    n = n()
  ) %>%
  ggplot(aes(x = mean_concern, y = reorder(liberty_type, mean_concern))) +
  geom_col(fill = "#2E86AB", alpha = 0.8) +
  geom_errorbar(aes(xmin = mean_concern - sd_concern, 
                    xmax = mean_concern + sd_concern),
                width = 0.3, linewidth = 0.8) +
  geom_text(aes(label = sprintf("%.1f", mean_concern)), 
            hjust = -0.2, size = 3.5) +
  labs(
    title = "Average Technology Acceptance by Liberty Type",
    subtitle = "Error bars show ± 1 SD",
    x = "Mean Technology Acceptance (0 = refusing tech, 100 = accepting tech)",
    y = "Liberty Type"
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    plot.title = element_text(face = "bold")
  )



LISS_democracy_long %>%
  group_by(benefit_type) %>%
  summarise(
    mean_concern = mean(problem_resp, na.rm = TRUE),
    sd_concern = sd(problem_resp, na.rm = TRUE),
    se_concern = sd_concern / sqrt(n()),
    n = n()
  ) %>%
  ggplot(aes(x = mean_concern, y = reorder(benefit_type, mean_concern))) +
  geom_col(fill = "#2E86AB", alpha = 0.8) +
  geom_errorbar(aes(xmin = mean_concern - sd_concern, 
                    xmax = mean_concern + sd_concern),
                width = 0.3, linewidth = 0.8) +
  geom_text(aes(label = sprintf("%.1f", mean_concern)), 
            hjust = -0.2, size = 3.5) +
  labs(
    title = "Average Technology Acceptance by Benefit Type",
    subtitle = "Error bars show ± 1 SD",
    x = "Mean Technology Acceptance (0 = refusing tech, 100 = accepting tech)",
    y = "Benefit Type"
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    plot.title = element_text(face = "bold")
  )


```


Preregistered analyses

```{r preregistered analysis}


model1 = lmer(scale(problem_resp) ~ affected_stat + cost_stat + benefit_stat + (affected_stat+cost_stat+benefit_stat|nomem_encr) + (affected_stat+cost_stat+benefit_stat|benefit_type) + (affected_stat+cost_stat+benefit_stat|liberty_type), data = LISS_democracy_long, na.action=na.omit)

model1 = lmer(scale(problem_resp) ~ affected_stat*scale(outparty_dislike) + cost_stat + benefit_stat  + (1|nomem_encr) + (1|benefit_type) + (1|liberty_type), data = LISS_democracy_long, na.action=na.omit) 

summary(model1)




model1 = lmer(scale(problem_resp) ~ affected_stat*scale(outparty_dislike) + cost_stat + benefit_stat  + (1|nomem_encr) +  (1|benefit_type), data = LISS_democracy_long, na.action=na.omit) 

summary(model1)


#Per Liberty type
#####effects are stable within liberties, however, there is variance on the effect size level

liberty_types <- unique(LISS_democracy_long$liberty_type)

comparison_table <- map_df(liberty_types, function(lib_type) {
  subset_data <- LISS_democracy_long[LISS_democracy_long$liberty_type == lib_type, ]
  
  model <- lmer(
    scale(problem_resp) ~ affected_stat*scale(outparty_dislike) + 
      cost_stat + benefit_stat + 
      (1|nomem_encr) + (1|benefit_type), 
    data = subset_data, 
    na.action = na.omit
  )
  
  tidy(model, effects = "fixed") %>%
    mutate(liberty_type = lib_type)
})


comparison_wide <- comparison_table %>%
  select(liberty_type, term, estimate, p.value) %>%
  pivot_wider(
    names_from = term,
    values_from = c(estimate, p.value),
    names_glue = "{term}_{.value}"
  )



#PER BENEFIT TYPE
#####effects are stable within benefits, however, there is variance on the effect size level

liberty_types <- unique(LISS_democracy_long$benefit_type)

comparison_table <- map_df(liberty_types, function(lib_type) {
  subset_data <- LISS_democracy_long[LISS_democracy_long$benefit_type == lib_type, ]
  
  model <- lmer(
    scale(problem_resp) ~ affected_stat*scale(outparty_dislike) + 
      cost_stat + benefit_stat + 
      (1|nomem_encr) + (1|liberty_type), 
    data = subset_data, 
    na.action = na.omit
  )
  
  tidy(model, effects = "fixed") %>%
    mutate(liberty_type = lib_type)
})


comparison_wide <- comparison_table %>%
  select(liberty_type, term, estimate, p.value) %>%
  pivot_wider(
    names_from = term,
    values_from = c(estimate, p.value),
    names_glue = "{term}_{.value}"
  )






```

 visualisations


```{r prereg visualisation}

####horse race plot for individual estimates

library(broom.mixed)
library(ggplot2)
library(dplyr)

# Fit your model
model1 <- lmer(
  scale(problem_resp) ~ affected_stat*scale(outparty_dislike) + 
    cost_stat + benefit_stat*nettocat + 
    scale(liberty_prior_personal) + scale(liberty_prior_societal) + 
    (1|nomem_encr) + (1|benefit_type) + (1|liberty_type), 
  data = LISS_democracy_long, 
  na.action = na.omit
)

# Extract coefficients
coef_data <- tidy(model1, effects = "fixed", conf.int = TRUE) %>%
  filter(term != "(Intercept)") %>%  # Remove intercept
  mutate(
    significant = ifelse(p.value < 0.05, "Yes", "No"),
    term_clean = case_when(
      term == "affected_stat" ~ "Affected (Ingroup/Outgroup)",
      term == "scale(outparty_dislike)" ~ "Outparty Dislike",
      term == "cost_stat" ~ "Cost",
      term == "benefit_stat" ~ "Benefit",
      term == "nettocat" ~ "Income (Nettocat)",
      term == "scale(liberty_prior_personal)" ~ "Liberty Prior (Personal)",
      term == "scale(liberty_prior_societal)" ~ "Liberty Prior (Societal)",
      term == "affected_stat:scale(outparty_dislike)" ~ "Affected × Outparty Dislike",
      term == "benefit_stat:nettocat" ~ "Benefit × Income",
      TRUE ~ term
    )
  )

# Horse race plot
ggplot(coef_data, aes(x = estimate, y = reorder(term_clean, estimate), color = significant)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray50", linewidth = 0.8) +
  geom_point(size = 4) +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.3, linewidth = 1) +
  geom_text(aes(label = sprintf("%.3f", estimate)), 
            hjust = -0.3, size = 3.5, show.legend = FALSE) +
  scale_color_manual(values = c("No" = "#D5A021", "Yes" = "#06A77D"),
                     name = "p < .05") +
  labs(
    title = "Fixed Effects Estimates",
    subtitle = "Standardized coefficients with 95% confidence intervals",
    x = "Standardized Coefficient (β)",
    y = NULL
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(face = "bold", size = 14),
    panel.grid.major.y = element_blank(),
    axis.text.y = element_text(size = 11)
  )







```

```{r interaction plots} 

library(ggeffects)
library(ggplot2)

#Affected × Outparty Dislike; shows exactly as hypothesized, affective polarization is interacted with 
pred_interaction1 <- ggpredict(model1, terms = c("outparty_dislike [all]", "affected_stat"))

ggplot(pred_interaction1, aes(x = x, y = predicted, color = group, fill = group)) +
  geom_line(linewidth = 1.5) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.2, color = NA) +
  scale_color_manual(values = c("#E63946", "#457B9D", "#06A77D"),
                     labels = c("Outgroup", "Everyone", "Ingroup"),
                     name = "Who is Affected") +
  scale_fill_manual(values = c("#E63946", "#457B9D", "#06A77D"),
                    labels = c("Outgroup", "Everyone", "Ingroup"),
                    name = "Who is Affected") +
  labs(
    title = "Interaction: Affected Status × Outparty Dislike",
    x = "Outparty Dislike",
    y = "Technology Acceptance (standardized)"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")


```


```{r wild exploration}


model1 = lmer(scale(problem_resp) ~ affected_stat*scale(outparty_dislike)+ cost_stat*scale(liberty_prior_personal)+benefit_stat*scale(liberty_prior_personal)+benefit_stat*scale(liberty_prior_societal) + cost_stat*scale(liberty_prior_societal) + (1|nomem_encr) + (1|benefit_type) + (1|liberty_type), data = LISS_democracy_long, na.action=na.omit) 

summary(model1)


####RANDOM FOREST APPROACH

library(randomForest)
library(dplyr)
library(ggplot2)

rf_data <- LISS_democracy_long %>%
  select(problem_resp, affected_stat, outparty_dislike, cost_stat, benefit_stat,
         liberty_prior_personal, liberty_prior_societal, 
         nomem_encr, benefit_type, nettocat, liberty_type, leeftijd, geslacht) %>%
  na.omit() %>%
  mutate(
    benefit_type = as.character(benefit_type),
    liberty_type = as.character(liberty_type),
    geslacht = as.character(geslacht)
  )

rf_model2 <- randomForest(
  problem_resp ~ affected_stat + outparty_dislike + cost_stat + benefit_stat +
    liberty_prior_personal + liberty_prior_societal + nettocat + leeftijd + geslacht + 
    benefit_type + liberty_type,
  data = rf_data,
  importance = TRUE,
  ntree = 500,
  na.action = na.omit
)

print(rf_model2)

varImpPlot(rf_model2, main = "Variable Importance")
#variable importance plot suggests that prior beliefs matter the most 



```


```{r horse race wild exploration} 



# Fit your model
model1 <- lmer(
  scale(problem_resp) ~ affected_stat*scale(outparty_dislike) + 
    cost_stat*scale(liberty_prior_personal) + 
    benefit_stat*scale(liberty_prior_personal) + 
    benefit_stat*scale(liberty_prior_societal) + 
    cost_stat*scale(liberty_prior_societal) + 
    (1|nomem_encr) + (1|benefit_type) + (1|liberty_type), 
  data = LISS_democracy_long, 
  na.action = na.omit
)

# View summary
summary(model1)

# Extract coefficients with confidence intervals
coef_data <- tidy(model1, effects = "fixed", conf.int = TRUE) %>%
  filter(term != "(Intercept)") %>%
  mutate(
    significant = ifelse(p.value < 0.05, "Yes", "No"),
    term_clean = case_when(
      term == "affected_stat" ~ "Affected (Ingroup/Outgroup)",
      term == "scale(outparty_dislike)" ~ "Outparty Dislike",
      term == "cost_stat" ~ "Cost",
      term == "benefit_stat" ~ "Benefit",
      term == "scale(liberty_prior_personal)" ~ "Liberty Prior (Personal)",
      term == "scale(liberty_prior_societal)" ~ "Liberty Prior (Societal)",
      term == "affected_stat:scale(outparty_dislike)" ~ "Affected × Outparty Dislike",
      term == "cost_stat:scale(liberty_prior_personal)" ~ "Cost × Liberty Prior (Personal)",
      term == "scale(liberty_prior_personal):benefit_stat" ~ "Benefit × Liberty Prior (Personal)",
      term == "benefit_stat:scale(liberty_prior_societal)" ~ "Benefit × Liberty Prior (Societal)",
      term == "cost_stat:scale(liberty_prior_societal)" ~ "Cost × Liberty Prior (Societal)",
      TRUE ~ term
    )
  )

# Create horse race plot
ggplot(coef_data, aes(x = estimate, y = reorder(term_clean, estimate), color = significant)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray50", linewidth = 0.8) +
  geom_point(size = 4) +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.3, linewidth = 1) +
  geom_text(aes(label = sprintf("%.3f", estimate)), 
            hjust = ifelse(coef_data$estimate > 0, -0.3, 1.3), 
            size = 3.5, 
            show.legend = FALSE) +
  scale_color_manual(
    values = c("No" = "#D5A021", "Yes" = "#06A77D"),
    name = "p < .05"
  ) +
  labs(
    title = "Fixed Effects Estimates",
    subtitle = "Standardized coefficients with 95% confidence intervals",
    x = "Standardized Coefficient (β)",
    y = NULL
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11),
    panel.grid.major.y = element_blank(),
    axis.text.y = element_text(size = 10),
    axis.text.x = element_text(size = 10)
  )



```
